<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><title>Openshift Install (old) | Hkube</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="Hkube: HPC over Kubernetes."/><meta property="og:description" content="Hkube - HPC over Kubernetes, cloud native open source framework to run distributed pipeline of algorithms"/><meta property="og:type" content="website"/><meta property="og:url" content="http://hkube.org/"/><meta property="og:image" content="/img/home/og_image.png"/><meta property="og:image:type" content="image/png"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@hkube"/><meta name="twitter:title" content="Hkube: HPC over Kubernetes"/><meta name="twitter:description" content="Hkube HPC over Kubernetes"/><meta name="twitter:image" content="/img/home/twitter_image.png"/><link rel="shortcut icon" href="/img/home/favicon.png"/><link rel="home" type="application/rss+xml" href="/blog/rss.xml" title="Hkube Team Blog"/><link rel="stylesheet" href="/style.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300|Roboto:300"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,400i,600"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/></head><body><header class="nav-header "><section class="nav-section"><input type="checkbox" id="toggle-menu-checkbox" checked=""/><label id="toggle-menu" for="toggle-menu-checkbox" class=""><span id="toggle-menu-icon"></span></label><a class="nav-home" href="/"><img class="nav-logo" src="/img/home/top-logo.svg"/></a><nav id="nav-links"><a href="/learn/">Get Started</a><a href="/tech/">Tech</a><a href="/media/">Media</a><a href="/blog/">Blog</a><a href="https://playground.hkube.org/" target="_blank" rel="noopener noreferrer">Playground</a><a href="https://github.com/kube-HPC" target="_blank" rel="noopener noreferrer">GitHub</a><a href="/spec/" target="_blank">Spec</a></nav><div class="algolia-search-wrapper"><input type="text" id="algolia-search-input" placeholder="Search docs..."/></div></section></header><section class="column"><div class="documentationContent"><div class="inner-content"><h1>Openshift Install (old)</h1><div><h2 id="hkube-over-openshift">HKube over OpenShift<a class="hash-link" href="#hkube-over-openshift">#</a></h2><h3 id="pre-reqs">pre-reqs<a class="hash-link" href="#pre-reqs">#</a></h3><ol><li>add hkube helm repo</li></ol><pre class="prism language-console">helm repo add hkube http<span class="punctuation">:</span><span class="operator">/</span><span class="operator">/</span>hkube<span class="punctuation">.</span>org<span class="regex">/helm/</span></pre><h3 id="general-setup">general setup<a class="hash-link" href="#general-setup">#</a></h3><ul><li>set env for username (developer in this example)<br/><code>export USERNAME=developer</code></li><li>create a project for hkube (hkube in this example)  </li><li>create a project for tiller (tiller in this example)<br/><code>export NAMESPACE=hkube</code><br/><code>export TILLER_NAMESPACE=tiller</code>  </li></ul><h3 id="setup-helm-tiller">setup helm tiller<a class="hash-link" href="#setup-helm-tiller">#</a></h3><pre class="prism language-console">oc process <span class="operator">-</span>f https<span class="punctuation">:</span><span class="operator">/</span><span class="operator">/</span>github<span class="punctuation">.</span>com<span class="operator">/</span>openshift<span class="operator">/</span>origin<span class="operator">/</span>raw<span class="operator">/</span>master<span class="operator">/</span>examples<span class="operator">/</span>helm<span class="operator">/</span>tiller<span class="operator">-</span>template<span class="punctuation">.</span>yaml <span class="operator">-</span>p TILLER_NAMESPACE<span class="operator">=</span><span class="string">&quot;${TILLER_NAMESPACE}&quot;</span> <span class="operator">-</span>p HELM_VERSION<span class="operator">=</span>v2<span class="number">.14</span><span class="punctuation">.</span><span class="number">3</span> <span class="operator">|</span> oc create <span class="operator">-</span>f <span class="operator">-</span>
oc policy add<span class="operator">-</span>role<span class="operator">-</span>to<span class="operator">-</span>user admin <span class="string">&quot;system:serviceaccount:${TILLER_NAMESPACE}:tiller&quot;</span></pre><h3 id="setup-required-prerequisites-as-admin">setup required prerequisites as admin<a class="hash-link" href="#setup-required-prerequisites-as-admin">#</a></h3><pre class="prism language-console"># create CRD object
cat <span class="operator">&lt;</span><span class="operator">&lt;</span>EOF <span class="operator">|</span> kubectl apply <span class="operator">-</span>f <span class="operator">-</span>
apiVersion<span class="punctuation">:</span> <span class="string">&quot;apiextensions.k8s.io/v1beta1&quot;</span>
kind<span class="punctuation">:</span> CustomResourceDefinition
metadata<span class="punctuation">:</span>
  name<span class="punctuation">:</span> etcdclusters<span class="punctuation">.</span>etcd<span class="punctuation">.</span>database<span class="punctuation">.</span>coreos<span class="punctuation">.</span>com
spec<span class="punctuation">:</span>
  group<span class="punctuation">:</span> etcd<span class="punctuation">.</span>database<span class="punctuation">.</span>coreos<span class="punctuation">.</span>com
  names<span class="punctuation">:</span>
    kind<span class="punctuation">:</span> EtcdCluster
    listKind<span class="punctuation">:</span> EtcdClusterList
    plural<span class="punctuation">:</span> etcdclusters
    shortNames<span class="punctuation">:</span>
    <span class="operator">-</span> etcd
    singular<span class="punctuation">:</span> etcdcluster
  scope<span class="punctuation">:</span> Namespaced
  version<span class="punctuation">:</span> v1beta2
EOF
# add role <span class="keyword">for</span> needed permissions and bind it to the user 
oc create clusterrole hkube<span class="operator">-</span>installer<span class="operator">-</span>role <span class="operator">--</span>verb<span class="operator">=</span>create<span class="punctuation">,</span><span class="keyword">get</span><span class="punctuation">,</span>list<span class="punctuation">,</span>watch<span class="punctuation">,</span>update<span class="punctuation">,</span>patch<span class="punctuation">,</span><span class="keyword">delete</span><span class="punctuation">,</span>deletecollection <span class="operator">--</span>resource<span class="operator">=</span>etcdclusters<span class="punctuation">.</span>etcd<span class="punctuation">.</span>database<span class="punctuation">.</span>coreos<span class="punctuation">.</span>com<span class="punctuation">,</span>events<span class="punctuation">,</span>ingresses<span class="punctuation">.</span>extensions
oc adm policy add<span class="operator">-</span>role<span class="operator">-</span>to<span class="operator">-</span>user hkube<span class="operator">-</span>installer<span class="operator">-</span>role $USERNAME <span class="operator">--</span>role<span class="operator">-</span>namespace<span class="operator">=</span>$NAMESPACE <span class="operator">-</span>n $NAMESPACE
oc adm policy add<span class="operator">-</span>role<span class="operator">-</span>to<span class="operator">-</span>user hkube<span class="operator">-</span>installer<span class="operator">-</span>role <span class="string">&quot;system:serviceaccount:${TILLER_NAMESPACE}:tiller&quot;</span> <span class="operator">-</span>n $TILLER_NAMESPACE
oc adm policy add<span class="operator">-</span>role<span class="operator">-</span>to<span class="operator">-</span>user hkube<span class="operator">-</span>installer<span class="operator">-</span>role <span class="string">&quot;system:serviceaccount:${TILLER_NAMESPACE}:tiller&quot;</span> <span class="operator">-</span>n $NAMESPACE</pre><h3 id="install-nginx-ingress-controller">Install nginx ingress controller<a class="hash-link" href="#install-nginx-ingress-controller">#</a></h3><p>Installing nginx-ingress-controller in openshift without admin requires a few prelimiary steps  </p><ol><li>create a pvc named <code>nginx-pvc-tmp</code> in the openshift console. any size will do</li><li>Create nginx-values.yaml</li></ol><pre class="prism language-console">cat <span class="operator">&lt;</span><span class="operator">&lt;</span>EOF <span class="operator">&gt;</span>nginx<span class="operator">-</span>values<span class="punctuation">.</span>yaml
controller<span class="punctuation">:</span>
  image<span class="punctuation">:</span>
    repository<span class="punctuation">:</span> quay<span class="punctuation">.</span>io<span class="operator">/</span>kubernetes<span class="operator">-</span>ingress<span class="operator">-</span>controller<span class="operator">/</span>nginx<span class="operator">-</span>ingress<span class="operator">-</span>controller
    pullPolicy<span class="punctuation">:</span> IfNotPresent
    runAsUser<span class="punctuation">:</span> <span class="number">1000170000</span>
    allowPrivilegeEscalation<span class="punctuation">:</span> <span class="keyword">false</span>
  containerPort<span class="punctuation">:</span>
    http<span class="punctuation">:</span> <span class="number">8080</span>
    https<span class="punctuation">:</span> <span class="number">6443</span>    
  service<span class="punctuation">:</span>
    ports<span class="punctuation">:</span>
      http<span class="punctuation">:</span> <span class="number">8080</span>
      https<span class="punctuation">:</span> <span class="number">6443</span>    
  extraArgs<span class="punctuation">:</span> 
    http<span class="operator">-</span>port<span class="punctuation">:</span> <span class="number">8080</span>
    https<span class="operator">-</span>port<span class="punctuation">:</span> <span class="number">6443</span>
  extraVolumeMounts<span class="punctuation">:</span> 
  # Additional volumeMounts to the controller main container<span class="punctuation">.</span>
    <span class="operator">-</span> name<span class="punctuation">:</span> ssl
      mountPath<span class="punctuation">:</span> <span class="operator">/</span>etc<span class="operator">/</span>ingress<span class="operator">-</span>controller<span class="operator">/</span>ssl
    <span class="operator">-</span> name<span class="punctuation">:</span> nginx
      mountPath<span class="punctuation">:</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>opentracing<span class="punctuation">.</span>json
      subPath<span class="punctuation">:</span> opentracing<span class="punctuation">.</span>json
    <span class="operator">-</span> name<span class="punctuation">:</span> nginx
      mountPath<span class="punctuation">:</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>nginx<span class="punctuation">.</span>conf
      subPath<span class="punctuation">:</span> nginx<span class="punctuation">.</span>conf
    <span class="operator">-</span> name<span class="punctuation">:</span> nginx
      mountPath<span class="punctuation">:</span> <span class="operator">/</span>tmp
  extraVolumes<span class="punctuation">:</span> 
  # Additional volumes to the controller pod<span class="punctuation">.</span>
    <span class="operator">-</span> name<span class="punctuation">:</span> ssl
      emptyDir<span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span>    
    <span class="operator">-</span> name<span class="punctuation">:</span> nginx
      persistentVolumeClaim<span class="punctuation">:</span>
        claimName<span class="punctuation">:</span> nginx<span class="operator">-</span>pvc<span class="operator">-</span>tmp
  extraInitContainers<span class="punctuation">:</span> 
  # Containers<span class="punctuation">,</span> which are run before the app containers are started<span class="punctuation">.</span>
    <span class="operator">-</span> name<span class="punctuation">:</span> init<span class="operator">-</span>mount
      image<span class="punctuation">:</span> busybox
      command<span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&#x27;sh&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;-c&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;echo {} &gt;/tmp/nginx/opentracing.json; touch /tmp/nginx/nginx.conf&#x27;</span><span class="punctuation">]</span>
      volumeMounts<span class="punctuation">:</span>
        <span class="operator">-</span> name<span class="punctuation">:</span> nginx
          mountPath<span class="punctuation">:</span> <span class="operator">/</span>tmp<span class="operator">/</span>nginx
  scope<span class="punctuation">:</span>
    enabled<span class="punctuation">:</span> <span class="keyword">true</span>
defaultBackend<span class="punctuation">:</span>
  image<span class="punctuation">:</span>
    runAsUser<span class="punctuation">:</span> <span class="number">1000170000</span>
  service<span class="punctuation">:</span>
    servicePort<span class="punctuation">:</span> <span class="number">8080</span> 
EOF</pre><ol><li>install nginx</li></ol><pre class="prism language-console">helm install <span class="operator">--</span>name nginx <span class="operator">-</span>f <span class="punctuation">.</span><span class="operator">/</span>nginx<span class="operator">-</span>values<span class="punctuation">.</span>yaml hkube<span class="operator">/</span>nginx<span class="operator">-</span>ingress</pre><ol><li>create a route for the nginx service (nginx-nginx-ingress-controller)</li></ol><h3 id="install-hkube">Install HKube<a class="hash-link" href="#install-hkube">#</a></h3><ol><li>create values file for install</li></ol><pre class="prism language-console">cat <span class="operator">&lt;</span><span class="operator">&lt;</span>EOF <span class="operator">&gt;</span>hkube<span class="operator">-</span>values<span class="punctuation">.</span>yaml
env<span class="punctuation">:</span>
  default_storage<span class="punctuation">:</span> <span class="string">&#x27;fs&#x27;</span>
global<span class="punctuation">:</span>
  production<span class="punctuation">:</span> <span class="keyword">true</span>
  ingress_controller_enable<span class="punctuation">:</span> <span class="keyword">false</span>
  k8senv<span class="punctuation">:</span> openshift
  namespaced<span class="punctuation">:</span> <span class="keyword">true</span>
  isPrivileged<span class="punctuation">:</span> <span class="keyword">false</span>
  clusterName<span class="punctuation">:</span> cluster<span class="punctuation">.</span>local
  # registry<span class="punctuation">:</span> docker<span class="punctuation">.</span>io<span class="operator">/</span>
  registry<span class="punctuation">:</span> <span class="string">&quot;&quot;</span>
  storage<span class="punctuation">:</span>
    binary<span class="punctuation">:</span> <span class="keyword">true</span>
    fs<span class="punctuation">:</span>
      pvc<span class="punctuation">:</span> 
         name<span class="punctuation">:</span> <span class="string">&#x27;hkube-storage&#x27;</span>
         capacity<span class="punctuation">:</span> <span class="string">&#x27;50Gi&#x27;</span>
         # pv_name<span class="punctuation">:</span> pv0100
         # storage_class<span class="punctuation">:</span> <span class="string">&#x27;&#x27;</span>
         # nfs_server<span class="punctuation">:</span> <span class="string">&#x27;172.31.20.233&#x27;</span>
         # nfs_root<span class="punctuation">:</span> <span class="string">&#x27;/var/nfs/hkube&#x27;</span>
      base_directory<span class="punctuation">:</span> <span class="string">&#x27;/hkubedata&#x27;</span>
  ingress<span class="punctuation">:</span>
    use_regex<span class="punctuation">:</span> <span class="keyword">true</span>      
build_secret<span class="punctuation">:</span>
  docker_registry<span class="punctuation">:</span> <span class="string">&#x27;&#x27;</span>
  docker_namespace<span class="punctuation">:</span> <span class="string">&#x27;&#x27;</span>
  docker_username<span class="punctuation">:</span> my_docker_username
  docker_password<span class="punctuation">:</span> my_docker_password
algorithm_operator<span class="punctuation">:</span>
  build_mode<span class="punctuation">:</span> openshift
# needed <span class="keyword">for</span> single node <span class="punctuation">(</span>testing<span class="punctuation">)</span>  
#thirdparty<span class="punctuation">:</span>
#  redis<span class="operator">-</span>ha<span class="punctuation">:</span>
#    hardAntiAffinity<span class="punctuation">:</span> <span class="keyword">false</span>
EOF</pre><ol><li>create pv for hkube and set the name above (or define default storage class)</li><li>install hkube</li></ol><pre class="prism language-console">helm install <span class="operator">--</span>name hkube <span class="operator">-</span>f hkube<span class="operator">-</span>values<span class="punctuation">.</span>yaml hkube<span class="operator">/</span>hkube</pre></div><div><a class="read-next" href="/learn/api/"><span class="read-next-continue">Next →</span><span class="read-next-title">API</span></a></div></div><div class="nav-docs"><div><h3>Learn</h3><ul><li><a style="margin-left:0;" class="active" href="/learn/debug/">Debug Algorithm</a><ul><li><a href="/learn/debug/#introduction">Introduction</a></li><li><a href="/learn/debug/#use-cases"> Use Cases</a></li><li><a href="/learn/debug/#how-to"> How To</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/pipelines/">Pipelines</a><ul><li><a href="/learn/pipelines/#raw">Raw</a></li><li><a href="/learn/pipelines/#stored"> Stored</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/nodes/">Nodes</a><ul><li><a href="/learn/nodes/#entry-nodes">Entry Nodes</a></li><li><a href="/learn/nodes/#final-nodes"> Final Nodes</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/input/">Input</a><ul><li><a href="/learn/input/#input-types">Input Types</a></li><li><a href="/learn/input/#input-order"> Input Order</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/options/">Options</a><ul><li><a href="/learn/options/#batch-tolerance">Batch Tolerance</a></li><li><a href="/learn/options/#verbosity-level"> Verbosity Level</a></li><li><a href="/learn/options/#pipeline-concurrency"> Pipeline Concurrency</a></li><li><a href="/learn/options/#ttl"> TTL</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/execution/">Pipeline Execution</a><ul><li><a href="/learn/execution/#flow-input">Flow Input</a></li><li><a href="/learn/execution/#reference"> Reference</a></li><li><a href="/learn/execution/#batch"> Batch</a></li><li><a href="/learn/execution/#batch-reference"> Batch Reference</a></li><li><a href="/learn/execution/#wait-any"> Wait Any</a></li><li><a href="/learn/execution/#output"> Output</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/advancedPipeline/">Advanced Pipeline Descriptor</a><ul><li><a href="/learn/advancedPipeline/#advance-options">Advance Options</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/triggers/">Triggers</a><ul><li><a href="/learn/triggers/#cron">Cron</a></li><li><a href="/learn/triggers/#pipelines"> Pipelines</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/webhooks/">Webhooks</a><ul><li><a href="/learn/webhooks/#progress">Progress</a></li><li><a href="/learn/webhooks/#result"> Result</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/caching/">Caching / Run Node</a><ul><li><a href="/learn/caching/#introduction">Introduction</a></li><li><a href="/learn/caching/#use-cases"> Use Cases</a></li><li><a href="/learn/caching/#how-to-activate-cache"> How to activate cache</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/codeapi/">Code API</a><ul><li><a href="/learn/codeapi/#introduction">Introduction</a></li><li><a href="/learn/codeapi/#python"> Python</a></li><li><a href="/learn/codeapi/#java"> Java</a></li><li><a href="/learn/codeapi/#node-js"> Node.js</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/versions/">Versions</a><ul><li><a href="/learn/versions/#algorithms">Algorithms</a></li><li><a href="/learn/versions/#pipelines"> Pipelines</a></li></ul></li><li><a style="margin-left:0;" class="active" href="/learn/tensorboard/">Tensorboard Integration</a><ul><li><a href="/learn/tensorboard/#introduction">Introduction</a></li><li><a href="/learn/tensorboard/#config"> Config</a></li></ul></li></ul></div></div></div></section><footer><section class="sitemap"><div class="sitemap-group"><h5><a href="/learn/">Learn</a></h5><a href="/learn/">Introduction</a><a href="/learn/pipelines/">Pipeline</a><a href="/learn/nodes/">Nodes</a><a href="/learn/input/">Input</a><a href="/learn/execution/">Execution</a><a href="/learn/webhooks/">Webhooks</a></div><div class="sitemap-group"><h5><a href="/tech/dashboard/">Dashboard</a></h5><a href="/tech/dashboard/#overview">Overview</a><a href="/tech/dashboard/#tables">Tables</a><a href="/tech/dashboard/#operations">Operations</a></div><div class="sitemap-group"><h5><a href="/media/">Media</a></h5><a href="/media/#jane/">Meet Jane</a><a href="/media/#distributed/">Distributed pipeline</a><a href="/media/#hpc/">HPC over Kubernetes</a><a href="/media/#architecture/">Hkube Architecture</a></div><div class="sitemap-group"><h5><a href="/learn/algorithms/">Algorithms</a></h5><a href="/learn/algorithms/">Introduction</a><a href="/learn/algorithms/#api/">API</a><a href="/learn/algorithms/#implement/">Implement</a><a href="/learn/algorithms/#build/">Build</a><a href="/learn/algorithms/#publish/">Publish</a></div></section><section class="copyright">Copyright ©<span><script>document.write(new Date().getFullYear())</script> </span><noscript>2018</noscript>Hkube. MIT</section></footer><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script type="text/javascript" src="/vendor/scroller.js"></script><script>
        docsearch({
          appId: 'BQD9PBVIWN',
          apiKey: '1866dee8e47cc3f926114008ed8f7756',
          indexName: 'hkube',
          inputSelector: '#algolia-search-input',
          debug: false
        });
      </script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-118778729-1"></script><script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-118778729-1');
      </script></body></html>